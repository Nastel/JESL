<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>JESL by Nastel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">JESL</h1>
      <h2 class="project-tagline">jKool Event Streaming Library</h2>
      <a href="https://github.com/Nastel/JESL" class="btn">View on GitHub</a>
      <a href="https://github.com/Nastel/JESL/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Nastel/JESL/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="jesl---jkool-event-streaming-library" class="anchor" href="#jesl---jkool-event-streaming-library" aria-hidden="true"><span class="octicon octicon-link"></span></a>JESL - jKool Event Streaming Library</h1>

<p>JESL allows application developers stream time-series data to jKool Cloud.
To stream data to jKool Cloud your application must:</p>

<pre><code>1. Use TNT4J, or log4J+TNT4JAppender in your application
   to log events, activities, metrics

2. Obtain your jKool account and API access token 
   at https://www.jkoolcloud.com

3. Use JESL Event Sink implementation (contained in this project) 
   within your tnt4j configuration. API access token will be required
   to stream data to jKool Cloud.

4. Configure your application for streaming to jKool Cloud 
   using JESL Event Sink (requires API access token).
   See (`com.jkool.jesl.tnt4j.sink.JKCloudEventSinkFactory`)
</code></pre>

<p>JESL consists of the following main components:</p>

<pre><code>1. TNT4J streaming library and `TNT4JAppender` for log4j
   (https://github.com/Nastel/TNT4J)

2. JESL Simulator -- stream simulated events, activities and metrics
   to jKool Cloud. Simulations are defined in XML files.
   (see `sims/tnt4j-sim-template.xml` and `sims/order-process.xml`) 

3. JESL Event Sink -- TNT4J Event Sink implementation
   to stream events to jKool Cloud.
</code></pre>

<h2>
<a id="jesl-simulator" class="anchor" href="#jesl-simulator" aria-hidden="true"><span class="octicon octicon-link"></span></a>JESL Simulator</h2>

<p>The JESL Simulator provides the ability to simulate tracking activities
and events. The activities, events, and their components are defined using
a XML format.  There are three major parts to a simulation definition:</p>

<pre><code>1. Sources
   Defines the sources involved in simulated activities and events

2. Messages
   Defines the messages that will be exchanged during activities

3. Activities and Events
   Defines the actual activities and the sub-activities and events in them
</code></pre>

<p>The included file <code>sims/tnt4j-sim-template.xml</code> contains a simulation definition template,
along with detailed descriptions of each element, showing the XML element
hierarchy. The file order-process.xml contains a sample set of activities and
their events, along with some sample snapshots.</p>

<p>To define a simulation, copy one of the supplied XML simulation definition
files to use as a template and create the necessary activity elements.</p>

<p>The simulator can be run in one of two modes:</p>

<pre><code>1. Simulation (simulation type: `run`)
   Runs default simulation file (`sims/order-process.xml`) and sends the tracking data to
   the JESL Event Sink and/or writes the tracking data to the
   specified file.  In this mode, the simulator can be configured to
   run the simulation file a specified number of iterations, optionally
   generating unique correlators and tags for each iteration of
   the simulation file (appends a unique value to end of defined
   correlator and tags in simulation definition file).

2. Replay (simulation type: `replay`)
   Reads previously-saved tracking data from the specified file
   and sends it to the JESL Event Sink
</code></pre>

<p>The simplest way to run the simulator is to execute the file <code>jksim.bat</code>
(or <code>jksim.sh</code>) as follows:</p>

<pre><code>Windows: `jksim.bat &lt;access_token&gt; [&lt;iterations&gt;]`
Unix: `jksim.sh &lt;access_token&gt; [&lt;iterations&gt;]`
</code></pre>

<p><code>&lt;iterations&gt;</code> is the number of iterations for a given simulation (1 default).</p>

<p><b>NOTE:</b> You will need to alter <code>jksim</code> scripts to specify
custom simulator parameters such as simulation type as well as options described
further in this document.</p>

<p>The simulator also contains options for allowing the data values used for some of
the tracking component attributes to be altered to provide unique values for these
attributes for each tracking activity so that each activity definition in the input
file serves as a template for the activities to generate, allowing each to be a unique
instance of an activity with the defined components.  An example of such an attribute
is the Correlator.  If a Correlator is defined and the correlator value is not unique
across each activity then all activities will get stitched together into one large
activity.</p>

<p>Some of the available options are:</p>

<pre><code>-A      This option specifies the access token to use to validate
        connection to JESL Event Sink.  This option is required
        when using `-T` option

-p      This option will cause simulator to scale each time attribute
        up or down by the specified percentage.  This prevents each
        activity from looking exactly the same, showing some variation
        in the event durations, as well as the times between events

-u      Makes correlators and tags unique between iterations on the
        input file by appending a time stamp to each one, so that each
        iteration over the file will generate independent activities
        and events
</code></pre>

<p>To see the full set of supported options, run:</p>

<pre><code>`jksim.bat help`
</code></pre>

<h1>
<a id="streaming-syslog-to-jkool-cloud-" class="anchor" href="#streaming-syslog-to-jkool-cloud-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming Syslog to jKool Cloud </h1>

<p>JESL includes Syslog Daemon implementation. Please follow these steps to stream syslog to <code>jkoolcloud.com</code>:</p>

<ul>
<li>Obtain jkool cloud account. Edit <code>config/tnt4j.properties</code>, 

<ul>
<li>Locate <code>com.jkool.jesl.net.syslogd</code> stanza and provide your API access token.</li>
</ul>
</li>
<li>Run JESL syslogd <code>&lt;jesl-home&gt;/bin/syslogd &gt; syslogd.json</code>. 

<ul>
<li>By default JESL syslogd binds to TCP port <code>5140</code> and writes JSON formatted syslog messages.</li>
<li>JSON output can be played back using <code>&lt;jesl-home&gt;/bin/syslog</code> utility.</li>
</ul>
</li>
<li>Configure <code>syslog/rsyslog</code> to forward to JESL syslog daemon over TCP (<code>hostname</code> is where JESL syslogd is running)

<ul>
<li>RFC 3164 (e.g. <code>*.* @@hostname:5140</code>)</li>
<li>RFC 5424 (e.g. <code>*.* @@hostname:5140;RSYSLOG_SyslogProtocol23Format</code>)</li>
</ul>
</li>
<li>Send/playback syslog messages from command line (<code>&lt;jesl-home&gt;/bin/syslog</code>):</li>
</ul>

<pre><code>$ syslog -h localhost -p 5140 -f syslogd.json tcp
$ syslog -h localhost -p 5140 -l error -f user tcp "host appl-name[883]: my syslog mesasge about appl-name pid=883"
</code></pre>

<p>where <code>syslogd.json</code> is JSON output of JESL syslog daemon.</p>

<p>That should do it.</p>

<p><b>NOTE:</b> JESL currently supports (RFC 3164) and the Structured Syslog protocol (RFC 5424).</p>

<h1>
<a id="streaming-log4j-to-jkool-cloud-" class="anchor" href="#streaming-log4j-to-jkool-cloud-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming Log4j to jKool Cloud </h1>

<p>Log4J can be configured to stream events and metrics to jKool Cloud by using 
JESL log4j appender (<code>com.nastel.jkool.tnt4j.logger.log4j.TNT4JAppender</code>) as follows:</p>

<h4>
<a id="add-jesl-log4j-appender-to-your-log4j-configuration" class="anchor" href="#add-jesl-log4j-appender-to-your-log4j-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add JESL log4j appender to your log4j configuration</h4>

<pre><code>### Default JESL Appender configuration
log4j.appender.jkoolcloud=com.nastel.jkool.tnt4j.logger.log4j.TNT4JAppender
log4j.appender.jkoolcloud.SourceName=com.jkool.jesl.stream
log4j.appender.jkoolcloud.SourceType=APPL
log4j.appender.jkoolcloud.MetricsOnException=true
log4j.appender.jkoolcloud.MetricsFrequency=60
log4j.appender.jkoolcloud.layout=org.apache.log4j.PatternLayout
log4j.appender.jkoolcloud.layout.ConversionPattern=%d{ABSOLUTE} %-5p [%c{1}] %m%n

## JESL Configuration
log4j.logger.com.jkool.jesl.stream=off
log4j.logger.com.nastel.jkool=info
log4j.logger.com.jkool.jesl=info
</code></pre>

<p>Define categories that you want mapped to <code>jkoolcloud</code> appender. Example:</p>

<pre><code>log4j.logger.com.myco.mypackage=info,jkoolcloud
</code></pre>

<h4>
<a id="add-the-following-arguments-to-your-java-start-up" class="anchor" href="#add-the-following-arguments-to-your-java-start-up" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add the following arguments to your java start-up</h4>

<pre><code>-Dtnt4j.config=&lt;jesl.home&gt;/log4j/tnt4j.properties -Dtnt4j.token.repository=&lt;jesl.home&gt;/log4j/tnt4j-tokens.properties 
</code></pre>

<p>To enable automatic application dump add the following arguments:</p>

<pre><code>-Dtnt4j.dump.on.vm.shutdown=true -Dtnt4j.dump.on.exception=true -Dtnt4j.dump.provider.default=true 
</code></pre>

<p>Optionally you can add the following parameters to define default data center name and geo location:</p>

<pre><code>-Dtnt4j.source.DATACENTER=YourDataCenterName -Dtnt4j.source.GEOADDR="Melville, NY" 
</code></pre>

<p>Make sure <code>&lt;jesl.home&gt;/jkool-jesl.jar</code> and all dependent jar files in <code>&lt;jesl.home&gt;/lib</code> are in your class path.</p>

<h4>
<a id="edit-jeslhomelog4jtnt4jproperties-and-replace-your-access-token-with-your-jkool-api-access-token" class="anchor" href="#edit-jeslhomelog4jtnt4jproperties-and-replace-your-access-token-with-your-jkool-api-access-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Edit <code>&lt;jesl.home&gt;/log4j/tnt4j.properties</code> and replace <code>YOUR-ACCESS-TOKEN</code> with your jKool API access token.</h4>

<p>This allows streaming data to be associated with your private repository.
<b>NOTE</b>: Make sure your firewall allows outgoing <code>http</code> connections to <a href="http://data.jkoolcloud.com:6580">http://data.jkoolcloud.com:6580</a></p>

<h4>
<a id="restart-your-application" class="anchor" href="#restart-your-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Restart your application</h4>

<p>log4j messages which map to JESL <code>jkoolcloud</code> appender will stream to jKool Cloud @ <a href="http://data.jkoolcloud.com:6580">http://data.jkoolcloud.com:6580</a></p>

<h4>
<a id="login-to-my-dashboard--httpswwwjkoolcloudcom" class="anchor" href="#login-to-my-dashboard--httpswwwjkoolcloudcom" aria-hidden="true"><span class="octicon octicon-link"></span></a>Login to "My Dashboard" @ <a href="https://www.jkoolcloud.com/">https://www.jkoolcloud.com/</a>
</h4>

<p><b>NOTE</b>: Visit <a href="https://github.com/Nastel/TNT4J#log4j-integration">https://github.com/Nastel/TNT4J#log4j-integration</a> for more information on <code>TNT4JAppender</code>.
Optionally you may annotate your log4j messages to provide better context, timing as well as report
user defined metrics. Example: </p>

<div class="highlight highlight-java"><pre>logger<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">"</span>Starting a tnt4j activity #beg=Test, #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName());
logger<span class="pl-k">.</span>warn(<span class="pl-s"><span class="pl-pds">"</span>First log message #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, #msg='1 Test warning message'<span class="pl-pds">"</span></span>);
logger<span class="pl-k">.</span>error(<span class="pl-s"><span class="pl-pds">"</span>Second log message #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, #msg='2 Test error message'<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">Exception</span>(<span class="pl-s"><span class="pl-pds">"</span>test exception<span class="pl-pds">"</span></span>));
logger<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">"</span>Ending a tnt4j activity #end=Test, #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> #%i/order-no=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> orderNo);</pre></div>

<h1>
<a id="streaming-tnt4j-to-jkool-cloud-" class="anchor" href="#streaming-tnt4j-to-jkool-cloud-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming TNT4J to jKool Cloud </h1>

<p>Applications that use TNT4J can be configured to stream events and metrics to jKool Cloud
by configuring application source to use JESL Event Sink (<code>com.jkool.jesl.tnt4j.sink.JKCloudEventSinkFactory</code>)
Configure your TNT4J source as follows (using <code>tnt4j.properties</code> file):</p>

<pre><code>{
    ....
    ; event sink configuration: destination and data format
    event.sink.factory: com.nastel.jkool.tnt4j.sink.BufferedEventSinkFactory
    event.sink.factory.EventSinkFactory: com.jkool.jesl.tnt4j.sink.JKCloudEventSinkFactory
    event.sink.factory.EventSinkFactory.Url: http://data.jkoolcloud.com:6580
    event.sink.factory.EventSinkFactory.Token: YOUR-ACCESS-TOKEN
    event.formatter: com.nastel.jkool.tnt4j.format.JSONFormatter
    ....
}
</code></pre>

<p>Below is an example of a sample TNT4J source (com.myco.myappl) configuration with 
JESL Event Sink (<code>com.jkool.jesl.tnt4j.sink.JKCloudEventSinkFactory</code>):</p>

<pre><code>{
    source: com.myco.myappl
    source.factory: com.nastel.jkool.tnt4j.source.SourceFactoryImpl
    source.factory.GEOADDR: NewYork
    source.factory.DATACENTER: HQDC
    source.factory.RootFQN: SERVER=?#DATACENTER=?#GEOADDR=? 

    tracker.factory: com.nastel.jkool.tnt4j.tracker.DefaultTrackerFactory
    dump.sink.factory: com.nastel.jkool.tnt4j.dump.DefaultDumpSinkFactory

    ; event sink configuration: destination and data format
    event.sink.factory: com.nastel.jkool.tnt4j.sink.BufferedEventSinkFactory
    event.sink.factory.EventSinkFactory: com.jkool.jesl.tnt4j.sink.JKCloudEventSinkFactory
    event.sink.factory.EventSinkFactory.Url: http://data.jkoolcloud.com:6580
    event.sink.factory.EventSinkFactory.Token: YOUR-ACCESS-TOKEN
    event.formatter: com.nastel.jkool.tnt4j.format.JSONFormatter

    ; Configure default sink filter based on level and time (elapsed/wait)
    event.sink.factory.Filter: com.nastel.jkool.tnt4j.filters.EventLevelTimeFilter
    event.sink.factory.Filter.Level: TRACE
    ; Uncomment lines below to filter out events based on elapsed time and wait time
    ; Timed event/activities greater or equal to given values will be logged
    ;event.sink.factory.Filter.ElapsedUsec: 100
    ;event.sink.factory.Filter.WaitUsec: 100

    tracking.selector: com.nastel.jkool.tnt4j.selector.DefaultTrackingSelector
    tracking.selector.Repository: com.nastel.jkool.tnt4j.repository.FileTokenRepository
}
</code></pre>

<p><b>NOTE:</b> You will need to provide your actual API access token in (<code>event.sink.factory.EventSinkFactory.Token</code>).</p>

<h1>
<a id="project-dependencies" class="anchor" href="#project-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Dependencies</h1>

<p>JESL requires the following:</p>

<ul>
<li>JDK 1.6+</li>
<li>TNT4J (<a href="https://github.com/Nastel/TNT4J">https://github.com/Nastel/TNT4J</a>)</li>
<li>Apache HTTP Client 4.2.5 (<a href="http://hc.apache.org/httpcomponents-client-ga/">http://hc.apache.org/httpcomponents-client-ga/</a>)</li>
<li>Apache HTTP Core 4.3.4 (<a href="http://hc.apache.org/httpcomponents-client-ga/">http://hc.apache.org/httpcomponents-client-ga/</a>)</li>
<li>Syslog4j (<a href="http://syslog4j.org/">http://syslog4j.org/</a>)</li>
<li>Joda Time (<a href="http://www.joda.org/joda-time/">http://www.joda.org/joda-time/</a>)</li>
<li>GSON (<a href="https://github.com/google/gson">https://github.com/google/gson</a>)</li>
</ul>

<h1>
<a id="related-projects" class="anchor" href="#related-projects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Related Projects</h1>

<ul>
<li>TrackingFilter (<a href="http://nastel.github.io/TrackingFilter/">http://nastel.github.io/TrackingFilter/</a>)</li>
<li>PingJMX (<a href="http://nastel.github.io/PingJMX/">http://nastel.github.io/PingJMX/</a>)</li>
</ul>

<h1>
<a id="available-integrations" class="anchor" href="#available-integrations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Available Integrations</h1>

<ul>
<li>TNT4J (<a href="https://github.com/Nastel/TNT4J">https://github.com/Nastel/TNT4J</a>)</li>
<li>Log4J (<a href="http://logging.apache.org/log4j/1.2/">http://logging.apache.org/log4j/1.2/</a>)</li>
<li>jkoolcloud.com (<a href="https://www.jkoolcloud.com">https://www.jkoolcloud.com</a>)</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Nastel/JESL">JESL</a> is maintained by <a href="https://github.com/Nastel">Nastel</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

